<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<title>hitTestPoint</title>
	<script type="text/javascript" src="../../lufylegend-1.8.12.js"></script>
	</head>
	<body>
			<div id="legend">
				
			</div>
<script>
var backLayer;
var layer;
var title;
init(1000/50,"legend",800,450,main);

LSprite.prototype.ismouseon=function(e,cd){
		var s = this;
		if(!s.visible || e==null)return false;
		if(s.shapes && s.shapes.length > 0){
			return s.ismouseonShapes(s.shapes,e.offsetX,e.offsetY);
		}
		var k = null,i=false,l=s.childList;
		var sc={x:s.x*cd.scaleX+cd.x,y:s.y*cd.scaleY+cd.y,scaleX:cd.scaleX*s.scaleX,scaleY:cd.scaleY*s.scaleY};
		if(s.mask && !s.mask.ismouseon(e,sc))return false;
		if(s.graphics)i = s.graphics.ismouseon(e,sc);
		if(!i){
			for(k=l.length-1;k>=0;k--){
				if(l[k].ismouseon)i = l[k].ismouseon(e,sc);
				if(i)break;
			}
		}
		return i;
};
LSprite.prototype.hitTestPoint=function(x,y){
		var s = this;
		var shapes = s.shapes;
		if(!shapes){
			shapes = {"type":"rect","arg":[[[0,0],[s.getWidth(),0],[s.getWidth(),s.getHeight()],[0,s.getHeight()]]]};
		}
		return s.ismouseonShapes(shapes,x,y);
};
LSprite.prototype._changeShape=function(type,arg,m){
		var v,arg = arg,r2;
		if(type == LShape.VERTICES){
			v = [];
			for(var i=0;i<arg.length;i++){
				v[i]=m.toArray([arg[i][0],arg[i][1],1]);
			}
		}else if(type == LShape.RECT){
			v = [[arg[0],arg[1]],[arg[0]+arg[2],arg[1]],[arg[0]+arg[2],arg[1]+arg[3]],[arg[0],arg[1]+arg[3]]];
			for(var i=0;i<arg.length;i++){
				v[i]=m.toArray([v[i][0],v[i][1],1]);
			}
		}else if(type == LShape.ARC){
			var v1 = m.toArray([arg[0],arg[1],1]),v2 = m.toArray([arg[0]+arg[2],arg[1],1]);
			r2 = (v1[0] - v2[0])*(v1[0] - v2[0]) + (v1[1] - v2[1])*(v1[1] - v2[1]);
			v = [v1[0],v1[1],Math.sqrt(r2),r2];
		}
		return {"type":type,"arg":v};
};
LSprite.prototype.ismouseonShapes=function(shapes,mx,my){
		var s = this;
		var parent = s;
		if(typeof shapes == UNDEFINED){
			shapes = s.shapes;
		}
		var m = s.getRootMatrix();
		for(var j=shapes.length-1;j>=0;j--){
			var child = shapes[j],v,arg = child.arg;
			v = s._changeShape(child.type,arg,m);
			v = v.arg;
			if(child.type == LShape.VERTICES){
				if(LGlobal.hitPolygon(v,mx,my))return true;
			}else if(child.type == LShape.RECT){
				if(LGlobal.hitPolygon(v,mx,my))return true;
			}else if(child.type == LShape.ARC){
				if((v[0] - mx)*(v[0] - mx) + (v[1] - my)*(v[1] - my) < v[3])return true;
			}
		}
		return false;
	};
function main(){
	backLayer = new LSprite();
	addChild(backLayer);
	backLayer.addEventListener(LEvent.ENTER_FRAME,onframe);
	title = new LTextField();
	title.size = 18;
	title.x = 10;
	title.y = 5;
	title.text = "hitTestPoint:false";
	
	addChild(title);
	
	layer = new LSprite();
	layer.x = 20;
	layer.y = 50;
	layer.graphics.drawRect(0,"#880088",[0,0,100,40],true,"#880088");
	layer.addShape(LShape.RECT,[0,0,100,40]);
	backLayer.addChild(layer);
	
	layer = new LSprite();
	layer.x = 200;
	layer.y = 100;
	layer.graphics.drawArc(0,"#880088",[0,0,30,0,2*Math.PI],true,"#880088");
	layer.addShape(LShape.ARC,[0,0,30]);
	backLayer.addChild(layer);
	
	layer = new LSprite();
	layer.x = 120;
	layer.y = 150;
	layer.graphics.drawVertices(0,"#880088",[[10,10],[50,100],[100,70]],true,"#880088");
	layer.addShape(LShape.VERTICES,[[10,10],[50,100],[100,70]]);
	backLayer.addChild(layer);
	onframe();
}
function onframe(e){
	for(var i=0;i<backLayer.childList.length;i++){
		if(backLayer.childList[i].hitTestPoint(mouseX,mouseY)){
			title.text = "hitTestPoint:true";
			return;
		}
	}
	title.text = "hitTestPoint:false";
}
</script>
	</body>
</html>
